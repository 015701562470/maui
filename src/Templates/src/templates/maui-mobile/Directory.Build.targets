<Project>

  <PropertyGroup>
    <!-- Required - Enable Launch Profiles for .NET 6 iOS/Android -->
    <_KeepLaunchProfiles>true</_KeepLaunchProfiles>
  </PropertyGroup>
  <ItemGroup>
    <!-- Required - Setup Single Project features -->
    <ProjectCapability Include="MauiSingleProject" />

    <!-- Optional - Enables a list of TFM's and device categories in the debug menu -->
    <!-- This allows easily toggling of debug target TFM by selecting the platform -->
    <!-- If removed, Top level debug targets show as a list of devices for the selected TFM -->
    <ProjectCapability Include="XamarinStaticLaunchProfiles" />
  </ItemGroup>

  <!-- Required - This must match the app project TFM -->
  <PropertyGroup>
    <WindowsTargetFramework>net6.0-windows10.0.19041</WindowsTargetFramework>
  </PropertyGroup>

  <!-- Required - Overwrite tasks that are not needed when multitargeting -->
  <Target Name="ValidateWinUIPlatform" />
  <Target Name="BinPlaceBootstrapDll" />

  <!-- Required: Temporarily adjust a path for generating with multitargeting -->
  <Target Name="_Prep_ComputeProcessXamlFilesBefore" BeforeTargets="Prep_ComputeProcessXamlFiles" Condition="$(TargetFramework.Contains('-windows'))">
    <PropertyGroup>
      <_OldOutputPath>$(OutputPath)</_OldOutputPath>
      <OutputPath>$(OutputPath)\$(RootNamespace)</OutputPath>
    </PropertyGroup>
  </Target>
  <Target Name="_Prep_ComputeProcessXamlFilesAfter" AfterTargets="Prep_ComputeProcessXamlFiles" Condition="$(TargetFramework.Contains('-windows'))">
    <PropertyGroup>
      <OutputPath>$(_OldOutputPath)</OutputPath>
    </PropertyGroup>
  </Target>

  <!-- Required: Inject the windows TFM into the builds of the app project -->
  <Target Name="FixFrameworksBefore" BeforeTargets="SetProjectReferenceProperties" Condition="'$(ProjectExt)' == '.wapproj'">
    <ItemGroup>
      <_MSBuildProjectReferenceExistent
        Update="@(_MSBuildProjectReferenceExistent)"
        SetConfiguration="TargetFramework=$(WindowsTargetFramework)" />
    </ItemGroup>
  </Target>

  <!-- Required: Overwrite the properties set by the AddProjectMetadata task as it was checking the outer build -->
  <Target Name="FixFrameworksAfter" AfterTargets="SetProjectReferenceProperties" Condition="'$(ProjectExt)' == '.wapproj'">
    <ItemGroup>
      <ProjectReferenceWithExtraMetadata Update="@(ProjectReferenceWithExtraMetadata)">
        <ReferenceSourceTarget>ProjectReference</ReferenceSourceTarget>
        <SkipGetTargetFrameworkProperties>True</SkipGetTargetFrameworkProperties>
        <TargetFramework>$(WindowsTargetFramework)</TargetFramework>
        <TargetFrameworkIdentifier>.NETCoreApp</TargetFrameworkIdentifier>
        <AdditionalProperties>
        </AdditionalProperties>
        <TargetFileName>%(Filename).dll</TargetFileName>
        <ReferenceOutputAssembly>true</ReferenceOutputAssembly>
        <PublishProfile>Properties\PublishProfiles\win10-$(Platform).pubxml</PublishProfile>
        <WindowsAppContainer>
        </WindowsAppContainer>
        <Private>false</Private>
        <MsixConfiguration>Debug</MsixConfiguration>
        <OutputItemType>
        </OutputItemType>
        <BuildReference>true</BuildReference>
        <OutputType>WinExe</OutputType>
        <MsbuildProjectExtensionsPath>%(Identity)..\obj\</MsbuildProjectExtensionsPath>
        <RuntimeIdentifiers>win10-x86;win10-x86;win10-arm64</RuntimeIdentifiers>
        <DependencyKind>Direct</DependencyKind>
        <ProjectGuid></ProjectGuid>
        <TargetFrameworkMoniker>.NETCoreApp,Version=v5.0</TargetFrameworkMoniker>
        <Configuration>$(Configuration)</Configuration>
        <AppxRecipeFilePath>%(Identity)..\bin\$(Configuration)\$(WindowsTargetFramework)\%(Filename).dll.build.appxrecipe</AppxRecipeFilePath>
        <ProjectName>%(Filename)</ProjectName>
        <TargetPlatformIdentifier>Windows</TargetPlatformIdentifier>
        <AppxUploadRecipeFilePath>%(Identity)..\bin\$(Configuration)\$(WindowsTargetFramework)\Upload\%(Filename).build.appxrecipe</AppxUploadRecipeFilePath>
        <TargetPlatformMinVersion>$(TargetPlatformMinVersion)</TargetPlatformMinVersion>
        <TargetName>%(Filename)</TargetName>
        <TargetDir>%(Identity)..\bin\$(Configuration)\$(WindowsTargetFramework)\</TargetDir>
        <CrtSDKReferenceVersion></CrtSDKReferenceVersion>
        <PlatformTarget>AnyCPU</PlatformTarget>
      </ProjectReferenceWithExtraMetadata>
    </ItemGroup>
  </Target>

</Project>
